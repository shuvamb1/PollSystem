<!DOCTYPE html>
<html>
<head>
  <title><%= poll.question %></title>
  <link rel="stylesheet" href="/styles.css">
  <style>
/* ===== Header Section ===== */ header { background: linear-gradient(135deg, #28a745, #218838); color: white; text-align: center; padding: 30px 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); } header h1 { margin: 0; font-size: 2.2rem; font-weight: bold; } header p { margin-top: 8px; font-size: 1.1rem; opacity: 0.9; }
    body {
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      padding: 20px;
      text-align: center;
    }
    h1 {
      color: #333;
      margin-bottom: 10px;
    }
    h3 {
      color: #555;
    }
    form {
      margin: 20px auto;
      display: inline-block;
      text-align: left;
      padding: 20px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
      font-size: 16px;
      transition: transform 0.2s ease;
    }
    button:hover {
      background: #45a049;
    }
    /* Pulse animation */
    .pulse {
      animation: pulseAnim 0.3s ease;
    }
    @keyframes pulseAnim {
      0%   { transform: scale(1); }
      50%  { transform: scale(1.15); }
      100% { transform: scale(1); }
    }
    #resultsChart {
      max-width: 600px;
      margin: 30px auto;
    }
  </style>
</head>
<body>
<header> <h1>Make Your Poll</h1> <p>Create polls, share them, and see live results instantly</p> </header>
<div class="container">
  <h1><%= poll.question %></h1>
  <h3>Total Votes: <span id="totalVotes"><%= poll.votes.reduce((a,b) => a+b, 0) %></span></h3>

  <form action="/vote/<%= poll.id %>" method="POST">
    <% poll.options.forEach((option, index) => { %>
      <div>
        <input type="radio" name="option" value="<%= index %>" required>
        <label><%= option %></label>
      </div>
    <% }) %>
    <button type="submit" id="voteBtn">Vote</button>
  </form>

  <canvas id="resultsChart"></canvas>

  <script src="/socket.io/socket.io.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const socket = io();
    socket.emit("joinPoll", "<%= poll.id %>");

    const ctx = document.getElementById('resultsChart').getContext('2d');

    const chart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: <%- JSON.stringify(poll.options) %>,
        datasets: [{
          label: 'Votes',
          data: <%- JSON.stringify(poll.votes.map(() => 0)) %>, // Start from 0 for animation
          backgroundColor: 'rgba(75, 192, 192, 0.6)'
        }]
      },
      options: {
        animation: {
          duration: 1000,
          easing: 'easeOutCubic',
          onComplete: function () {
            chart.data.datasets[0].data = <%- JSON.stringify(poll.votes) %>;
            chart.update();
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            precision: 0
          }
        }
      }
    });

    setTimeout(() => {
      chart.data.datasets[0].data = <%- JSON.stringify(poll.votes) %>;
      chart.update();
    }, 200);

    socket.on("voteUpdate", (data) => {
      chart.data.datasets[0].data = data.votes;
      chart.update();
      document.getElementById("totalVotes").innerText = data.totalVotes;
    });

    // Pulse animation on vote button click
    document.getElementById("voteBtn").addEventListener("click", function () {
      this.classList.add("pulse");
      setTimeout(() => this.classList.remove("pulse"), 300);
    });
  </script>
</div>
</body>
</html>

